---
title: "TypeScript ã¨ Repl.it ã§ Discord Bot ã‚’å‹•ã‹ã™"
emoji: "ğŸ“‘"
type: "tech"
topics: ["TypeScript", "Discord", "Bot", "Replit"]
published: true
---

# æ¦‚è¦
[TECHCAFEÃ—TAIR Advent Calender](https://qiita.com/advent-calendar/2021/techcafe_tair)ã®20æ—¥ç›®ã§ã™ï¼
æœ¬æ—¥ã¯ TypeScript ã¨ Repl.it ã‚’ç”¨ã„ã¦ï¼ŒDiscord Bot ã‚’ä½œæˆã™ã‚‹æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã™ï¼
ã“ã® Bot ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã—ãŸã‚³ãƒãƒ³ãƒ‰ã«å¯¾ã—ã¦å¿œç­”ã‚’è¡Œã„ã¾ã™ï¼
ã¾ãŸï¼Œèª¬æ˜ã«ã‚ãŸã£ã¦ Repl.it ã®[ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ](https://replit.com/@FuruNov/ts-disbot-template?v=1)ã‚’ä½œã‚Šã¾ã—ãŸï¼
ã“ã‚Œã‚’ Fork ã—ã¦ï¼Œæ‰‹è»½ã« Bot ã‚’å‹•ã‹ã™ã“ã¨ãŒã§ãã¾ã™ï¼

- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

https://replit.com/@FuruNov/ts-disbot-template?v=1

# ä½¿ã†ã‚‚ã®
1. TypeScript
2. Repl.it
3. Discord.js (v12.5.3)

# Discord.js ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³
Repl.it ã®ç’°å¢ƒã¯ï¼ŒDiscord.js ã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆv13ï¼‰ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ï¼
ã“ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«å¿…è¦ãª Node ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯12ã§ã™ï¼
ã—ã‹ã—ï¼ŒRepl.it ã§ä½¿ãˆã‚‹ Node ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ 10.24.1 ãªã®ã§ï¼Œã“ã‚Œã«å¯¾å¿œã—ã¦ã„ã‚‹ v12 ã®æœ€çµ‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¾ã™ï¼

# Bot ã®ä½œæˆ
[Discord Developer Portal](https://discord.com/developers/applications) ã§ Bot ã‚’ä½œæˆãƒ»æ‹›å¾…ã—ã¦ãã ã•ã„ï¼
è©³ç´°ã¯[ã“ã®è¨˜äº‹](https://note.com/exteoi/n/nf1c37cb26c41)ã®ã€ŒDiscordä¸Šã®Botã®ä½œæˆã€ã®é …ã§åˆ†ã‹ã‚Šã‚„ã™ãèª¬æ˜ã•ã‚Œã¦ã„ã‚‹ã®ã§ï¼Œã“ã¡ã‚‰ã‚’å‚ç…§ãã ã•ã„ï¼

https://discord.com/developers/applications
https://note.com/exteoi/n/nf1c37cb26c41

# Bot ã®å®Ÿè¡Œ
ä»¥ä¸‹ã®æ‰‹é †ã§ Bot ã®å®Ÿè¡ŒãŒã§ãã¾ã™ï¼
1. ä½œæˆã—ãŸ Bot ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚³ãƒ”ãƒ¼
2. Repl.it ã®ç’°å¢ƒå¤‰æ•° "TOKEN" ã«ï¼Œ1ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®š
3. ã‚¨ãƒ‡ã‚£ã‚¿ä¸Šã®ã€ŒRunã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™

è©³ç´°ã¯[ã“ã®è¨˜äº‹](https://disbot.info/bot-make/repl-djs-1/#Bot)ã®ã€ŒBotã‚’ä½œæˆã™ã‚‹ã€ã®é …ã§åˆ†ã‹ã‚Šã‚„ã™ãèª¬æ˜ã•ã‚Œã¦ã„ã‚‹ã®ã§ï¼Œã“ã¡ã‚‰ã‚’å‚ç…§ãã ã•ã„ï¼

https://disbot.info/bot-make/repl-djs-1/#Bot

# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®èª¬æ˜
Bot ã®å®Ÿè¡Œã«ç”¨ã„ã‚‹ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®èª¬æ˜ã‚’ã—ã¾ã™ï¼

## å¿…è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
```ts:index.ts
import * as http from 'http';
import * as discord from "discord.js"
```
- http
  - ã‚µãƒ¼ãƒãƒ¼ã®ä½œæˆã«ç”¨ã„ã¾ã™
- discord
  - Discord Bot ã®å®Ÿè¡Œã«ç”¨ã„ã¾ã™


## ã‚³ãƒãƒ³ãƒ‰ã®å®šç¾©
```ts:index.ts
async function ping(message: discord.Message) {
  message.channel.send("pong!")
}

async function pong(message: discord.Message) {
  message.channel.send("ping!")
}
```
ã‚³ãƒãƒ³ãƒ‰ã‚’é–¢æ•°ã¨ã—ã¦å®šç¾©ã—ã¾ã™ï¼
- ping
  - Bot ã¯ "pong!" ã‚’è¿”ã—ã¾ã™
- pong
  - Bot ã¯ "ping!" ã‚’è¿”ã—ã¾ã™


## ã‚³ãƒãƒ³ãƒ‰ãƒªã‚¹ãƒˆã®å®šç¾©
```ts:index.ts
const messageResponseDic: {
  [command: string]: (
    message: discord.Message,
    args?: string[],
  ) => void
} = {
  ping: ping,
  pong: pong,
}
```
ã‚³ãƒãƒ³ãƒ‰ã®ãƒªã‚¹ãƒˆã‚’é€£æƒ³é…åˆ—ã¨ã—ã¦å®šç¾©ã—ã¾ã™ï¼
ä»Šå›ã¯ç”¨ã„ã¾ã›ã‚“ãŒï¼Œargs ã¯ã‚³ãƒãƒ³ãƒ‰ã®å¼•æ•°ã¨ã—ã¦ç”¨ã„ã¾ã™ï¼


## ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¿œç­”ã™ã‚‹é–¢æ•°ã®å®šç¾©
```ts:index.ts
async function messageResponse(message: discord.Message) {
  const prefix = "!"
  const [command, ...args] = (
    message.content.slice(prefix.length).split(" ")
  )
  const isCommand = !message.author.bot && (
    message.content.startsWith(prefix)
  )
  if (!isCommand) return
  messageResponseDic[command](message, args)
}
```
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¿œç­”ã™ã‚‹é–¢æ•°ã‚’å®šç¾©ã—ã¾ã™ï¼
æœ€å¾Œã®è¡Œã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ï¼


## Bot ãŒè¡Œã†å¿œç­”ã®ãƒªã‚¹ãƒˆã®å®šç¾©
```ts:index.ts
const clientStateResponseDic: {
  [state: string]: (...args: any) => void
} = {
  ready: () => { console.log('This bot is ready') },
  message: messageResponse
}
```
Bot ãŒè¡Œã†å¿œç­”ã®ãƒªã‚¹ãƒˆã‚’é€£æƒ³é…åˆ—ã§å®šç¾©ã—ã¾ã™ï¼
- ready
  - Bot ã®å®Ÿè¡Œæº–å‚™ãŒå®Œäº†ã—ãŸã‚‰ï¼Œã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã« "This bot is ready" ã¨å‡ºåŠ›ã—ã¾ã™
- message
  - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ãŒè¡Œã‚ã‚ŒãŸå ´åˆã«ï¼Œã“ã‚ŒãŒã‚³ãƒãƒ³ãƒ‰ã§ã‚ã‚Œã°å¿œç­”ã‚’ã—ã¾ã™


## ã‚µãƒ¼ãƒãƒ¼ã®ä½œæˆ
```ts:index.ts
function requestListener(
  _: http.IncomingMessage,
  res: http.ServerResponse
) {
  res.write("This bot is online")
  res.end()
}

http.createServer(requestListener).listen(8080)
```
Bot ã®å®Ÿè¡Œã«ç”¨ã„ã‚‹ã‚µãƒ¼ãƒãƒ¼ã‚’ä½œæˆã—ã¾ã™ï¼

## Bot ã®å®Ÿè¡Œ
```ts:index.ts
const client = new discord.Client()
for (let [state, response] of Object.entries(clientStateResponseDic)) {
  client.on(state, response)
}
```
Bot ã‚’å®Ÿè¡Œã™ã‚‹å‡¦ç†ã§ã™ï¼
Bot ã®çŠ¶æ…‹ã«å¿œã˜ã¦ï¼ŒBot ã¯å¿œç­”ã‚’è¡Œã„ã¾ã™ï¼


## Bot ã®ãƒ­ã‚°ã‚¤ãƒ³
```ts:index.ts
const token = process.env['TOKEN']
client.login(token)
```
ä¸Šã§å®šç¾©ã—ãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”¨ã„ã¦ï¼ŒBot ã®ã‚µãƒ¼ãƒãƒ¼ã¸ã®ãƒ­ã‚°ã‚¤ãƒ³ã‚’è¡Œã„ã¾ã™ï¼

# ã¾ã¨ã‚
ä»¥ä¸ŠãŒ TypeScript ã¨ Repl.it ã§ Discord Bot ã‚’å‹•ã‹ã™æ–¹æ³•ã§ã—ãŸï¼

# å‚è€ƒè³‡æ–™
- Bot ã®ä½œæˆ

https://note.com/exteoi/n/nf1c37cb26c41

- Bot ã®å®Ÿè¡Œ

https://disbot.info/bot-make/repl-djs-1/#Bot